<html>
<head>
    <title>相册瀑布布局</title>
    <meta charset="utf-8" />
    <style type="text/css">
        .black_overlay{
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index:1001;
            -moz-opacity: 0.8;
            opacity:.80;
            filter: alpha(opacity=80);
        }
        .white_content {
            display: none;
            position: absolute;
            top: 25%;
            left: 25%;
            width: 50%;
            height: 50%;
            border: 2px solid orange;
            background-color: white;
            z-index:1002;
            overflow: auto;
        }
    </style>


</head>
<body>
<div id="light" class="white_content" onclick="showPhoto(this)">

</div>
<div id="fade" class="black_overlay" ></div>
</body>
<script language="javascript">
    //设置 宽度和栏数和间距都要提前设置

    function PFrame() {//定义高度和宽度
        this.setStyles = function (obj, styles) {
            for (var style in styles) {
                obj['style'][style] = styles[style];
            }
        };
        this.setAttr = function(obj, attrs){
            for (var attr in attrs) {
                obj.setAttribute(attr, attrs[attr]);
            }
        };
        this.getImg = function(imgObj) {
            var img = document.createElement('IMG');
            var styles = imgObj.styles;
            img.src = imgObj.src;
            this.setStyles(img, styles);
            return img;
        };
        this.getDiv = function(obj) {
            var item = document.createElement('DIV');
            var styles = obj.styles;
            item.src = obj.src;
            this.setStyles(item, styles);
            return obj;
        };
        this.options = {
            frame: {
                height: 500,
                cols: 4
            },
            item: {
                padding: 16,
                width: 150,

            }
        };

        this.createFrame = function(option) {
            option = option || this.options;
            var frame = document.createElement('DIV');
            option.className = 'cols';
            var width = option.item.width * option.frame.cols + (option.frame.cols + 1) * option.item.padding;
            var styles = {
                width: width,
                minHeight: option.frame.height,
                border: "1px solid black",
                display: 'flex'
            };
            this.setStyles(frame, styles);
            for(var i=0;i<option.frame.cols;i++){
                var item = document.createElement('DIV');
                if(option.className){
                    item.className = option.className;
                }
                var itemStyle = {
                    width: option.item.width,
                    minHeight: option.frame.height,
                    border: "1px solid black",
                    margin: option.item.padding
                };
                this.setStyles(item, itemStyle);
                frame.appendChild(item);
            }
            return frame;
        };

        this.getTarget = function() {
            function getHight(obj){
                var sum = 0;


                var items = obj.children;

                for(var i=0;i<items.length;i++){
                    sum += parseInt(items[i].style.height.split('px')[0]);
                }
                return sum;
            }
            var nodes = document.getElementsByClassName('cols');//累加子框中已添加照片的总高度，最小的优先选择
            var res = getHight(nodes[0]);
            var node=nodes[0];
            for(var i=1;i<nodes.length;i++){
                var height = getHight(nodes[i]);
                if(res > height){
                    res = height;
                    node=nodes[i];
                }
            }
            return node;
        };

        this.createChildFrame = function(frameObj, innerObj) {
            var div = document.createElement('DIV');
            if(frameObj.attr){
                this.setAttr(div, frameObj.attr);
            }
            if(frameObj.styles){
                this.setStyles(div, frameObj.styles);
            }
            var img = document.createElement('IMG');
            if(innerObj.attr){
                this.setAttr(img, innerObj.attr);
            }
            if(innerObj.styles){
                this.setStyles(img, innerObj.styles);
            }
            div.appendChild(img);
            return div;
        }

    }

    PFrame.prototype.addPhoto = function(obj) {
        var photo = this.createChildFrame(obj.frameObj, obj.innerObj);
        var target = this.getTarget();
        target.appendChild(photo);
    };
    var isShowed = false;
    function showPhoto(obj) {
        var light = document.getElementsByClassName('white_content')[0];
        var fade = document.getElementsByClassName('black_overlay')[0];

        if(!isShowed){
            isShowed = true;
            fade.style.display = 'block';
            light.innerHTML = obj.innerHTML;
            light.style.display = 'block';
        } else {
            isShowed = false;
            fade.style.display = 'none';
            light.style.display = 'none';
        }


    }
    var obj = {
        frameObj: {
            attr: {
                onmousedown: "showPhoto(this)"
            },
            styles: {
                width: "100%",
                height: '150px',
                marginBottom: '16px'
            }
        },
        innerObj: {
            attr: {
                src: "../task43/img2.jpg"
            },
            styles: {
                width: "100%",
                height: '100%'
            }
        }
    };

    var photos = [];
    function generatePhoto(frame, num) {
        for(var i=0; i<num;i++){
            var height = 150 + parseInt(Math.random()*100) + 'px';
            var src = '../task43/img'+ parseInt(Math.random()*2+1)+'.jpg';
            obj.frameObj.styles.height = height;
            obj.innerObj.attr.src = src;
            obj.innerObj.attr.alt = i;
            frame.addPhoto(obj);
        }
    }

    (function() {
        var pf1 = new PFrame();
        var frame = pf1.createFrame();
        document.body.appendChild(frame);

       generatePhoto(pf1, 12);

    })()
</script>
</html>